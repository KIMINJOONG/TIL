# Attached & Detached 컨테이너 이해

- 컨테이너를 다시 시작할때의 모드와 컨테이너를 처음 시작할때의 모드

```
docker start 컨테이너이름
```

해당 명령어로 다시 시작하면 터미널의 프로세스가 즉시 완료된다.

터미널의 실행중인 도커 컨테이너에 더 이상 이것을 연결하지않는다(그러나 컨테이너는 백그라운드로 실행중)
docker ps를 해본다면 분명 여전히 실행중인것을 확인할수있다. 따라서 이 컨테이너는 실행중이다.
터미널에서 우리를 차단하지 않을뿐이고, 이전에 실행한 docker run 과는 다르다. 이미 실행중인 컨테이너에서 포트 3000을 실행중이므로 다른 로컬 포트로 바인딩해서 컨테이너를 올려보자

```
docker run -p 8000:80 이미지명
```

여기서 다른포트를 사용하여 동일한 이미지를 기반으로 새로운 추가 컨테이너를 시작해보자
docker ps로 다시 확인해보면 두개의 컨테이너가 실행되는것을 볼 수 있다 그런데 여기서 docker run 명령어를 실행하면 해당 프로세스에서 막히는걸알수있다.
즉, 더이상의 명령을 실행할수없게된다. 타이핑은 되어도 실행은 안되는 상태이다. 이 프로세스는 터미널을 차단하고있지만(즉 컨테이너는 포그라운드에서 실행중), docker start는 그렇지 않다. 이것은 강제당하는것이 아니다. attached(연결)모드나 detached(분리)모드를 원하는대로 설정가능하다.
docker start로 시작하는 경우 detached 모드가 디폴트, docker run 인경우 attached모드가 디폴트이다.

# 왜 중요할까?

- 예제 애플리케이션에서는 새 목표를 설정할때마다 콘솔에 무언가를 기록한다. detached 모드로 시작된 컨테이너는 콘솔에 아무것도 표시되지않는다.
  반면에 docker run으로 실행한 새컨테이너인곳에서 실행해보면 터미널에도 표시되는것을 볼 수 있다. 실행중인 컨테이너에 연결되어있기때문이다.
  즉, attached모드는 단순히 우리가 그 컨테이너의 출력결과를 수신한다는것을 의미한다. 대표적으로 예를들면 콘솔에 출력되라는 내용(console.log())같은것
  그러나 우리가 디폴트로 연결되는것을 받아들이고 싶지않다면 detached모드에서 컨테이너를 실행할수있다. 이를위해 8000번 포트를 바인딩하고있는 컨테이너 하나를 중지시켜보자. 일단 중지되면 다시 실행하는데 이번엔 아래와 같은 명령어로 해보자

  ```
  docker run -p 8000:80 -d 이미지명
  ```

  명령어를 보면 -d가 추가된것을 알 수 있다. 이제 실행하면 자동으로 생성된 새 컨테이너ID를 얻고 docker ps로 확인할수있다.(분리된 컨테이너를 다시 연결할때는 docker container attach 컨테이너명) 그 후 다시 확인해보면 이제 터미널에서 콘솔찍히는걸 확인할수없는걸 볼수있다. 왜냐면 우리는 -d를 사용함으로써 detached모드로 실행했기때문이다. 하나의 동일한 터미널을 사용할때 이점은 다른 작업을 수행할수있다는것이다. 만약 실행중인 컨테이너를 계속 보고싶다면 두가지 방법이 있다

  1. attach 명령어 사용 컨테이너를 찾아 그 ID나 이름을 사용하여

  ```
  docker attach 컨테이너명
  ```

  이렇게 하면 그 이름의 컨테이너가 다시 연결되므로 출력결과가 다시 표시되는것을 볼 수 있다.

2. docker logs 명령어

   - 먼저 컨테이너를 찾은 후

   ```
    docker logs 컨테이너명
   ```

   을 실행하면 출력된 과거의 로그를 볼 수 있다. 또 한, 도커 로그의 옵션을 살펴보면 -f를 추가하여 follow 모드로 진입해서 계속 수신대기도 할 수 있다

   ```
   docker logs -f 컨테이너명
   ```

   을 실행하면 연결된 프로세스를 다시 갖게 되며, 해당 컨테이너의 향후 로그 출력 결과를 다시 볼 수 있게된다. 실행중인 컨테이너와 중지된 컨테이너 연결된 컨테이너와 분리된 컨테이너의 차이점 그것을 이해하는것은 굉장히 중요하다. 연결되어 있든 분리되어있든 그에 상관없이 여전히 실행중이며 컨테이너 내부의 정보가 필요한 경우 docker logs를 사용하거나 컨테이너를 다시 직접연결하여 추가 정보를 얻을수있다. 마지막으로 중지된 컨테이너를 재시작하고싶다면

   ```
   docker start -a 컨테이너명
   ```

   -a 플래그를 추가하여 attached 모드를 바로 시작 할 수 있다.
