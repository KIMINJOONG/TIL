# 인터렉티브 모드로 들어가기

- 이번 python-app-starting-setup폴더는 python 버전 3용으로 빌드된것이다.
  이것을 해보는 이유는 두가지가 있는데

  1. 도커가 노드와 웹 서버에 관한것만이 전부가 아니라는것을 알아보기위해서이다.
  2. 컨테이너 연결(attached) 및 분리(detached)와 관련이 있다.

  이번 파이썬앱은 코드를 보면 실제로 사용자가 앱과 상호작용해야하기때문에 지금 당장 이 예제를 백그라운드에서 동작하면 실제론 작동하진않지만, 단계별로 도커화(Dockerize)해보자

```
FROM python

WORKDIR /app

COPY . /app

CMD ["python", "rng.py"]

```

이와같이 명령어를 작성후 docker build . 를 실행해보자
이번엔 네트워크 기반 애플리케이션이 아니기때문에 포트를 공개하지않아도 된다.
그러므로 docker run 컨테이너Id로 실행해보자 그런데 이렇게 하면 에러가 발생한다.
docker run을 하면 디폴트로 attached모드로 시작하지만 오류메세지 외에는 표시되지않는다.
실행중인 컨테이너와 컨테이너로 실행중인 애플리케이션은 상호작용할수가 없다. 그 이유는 docker run을 사용하면 디폴트로 컨테이너에 연결된다 그래서 우리는 컨테이너에 출력된 결과를 받을수있었다 하지만 우리는 무엇이든 입력받을수있다는 견지에서 연결을 한것은 아니다. 컨테이너나 컨테이너로 실행되는 애플리케이션에는 그 어떤것도 입력할수가 없다. docker run --help를 실행해보자 실제로 우리에게 도움될 두가지 옵션이 있다.

1. 이 컨테이너를 인터렉티브 모드로 시작할수있는 -i 옵션이다.

   - 표준입력을 열린상태로 유지하며 attached모드가 아닌경우에도 컨테이너에 무언가를 입력 할 수 있다.
     그러나 이것을 일반적으로 -t와 결합하면 의사(pseudo)TTY가 할당되는데, 이것은 터미널을 생성한다는것을 의미한다. 따라서 i와 t를 결합하면 무언가를 입력할수있게된다. 따라서 컨테이너는 입력을 수신하고 컨테이너에 의해 노출되는 터미널도 얻게된다. 즉 컨테이너는 실제로 입력을 받는 장치가 되는것이다.

     ```
     docker run -it 컨테이너ID
     ```

     위의 명령어로 실행해보자
     이제 이것으로 충돌은 해결되었고 필요한 입력을 받을수 있게 되었다. 이제 컨테이너에의해 노출된 이 의사(pseudo)터미널과 통신하는 터미널에 무언가를 입력할수있다.
     또한 사용자 입력을 수신하는 컨테이너 프로세스에도 연결된다. 최소값과 최대값을 입력해보면 임의의 숫자가 반환된다. 컨테이너가 종료된후, 더 이상 실행되지 않는다는것도 알 수 있다. docker start로 재실행해보면 문제가 발생한다. docker start는 디폴트로 detached 모드이기에 컨테이너와 통신할수가 없다.
     이것을 해결하는 방법은 두가지가 있다.

   1. 하나는 빠르게 중지해서 attached 모드에서 컨테이너를 다시 시작하는것이다. docker stop 후 docker start -a 컨테이너ID
      그런데 이것은 이상하게 작동한후에 한번만 입력할수있다. 그래서 이건 맞는 방법이 아니다.

   2. docker start --help를 해보면 -a 뿐만 아니라 -i를 통해 컨테이너에 무언가를 입력할수 있다는걸 알 수 있다. 여기에는 -t 플래그가 필요하지않다. 처음에 -t플래그로 컨테이너를 실행하고 docker start명령을 사용하여 다시 컨테이너를 실행한다면 그 플래그가 여전히 기억되기 때문이다. 하지만 여기서 다시 시작한다면 출력 결과를 수신하고싶다는것을 강조해야한다.

   ```
   docker start -a -i 컨테이너ID
   ```

   이렇게 시작하면 동일하게 동작할것이다. 이것이 다시 시작하여 컨테이너에 연결할 수 있는 방법이다. 출력 결과 수신 전용 모드 뿐만아니라 무언가를 입력받고 싶은 모드에서도 마찬가지이다.

   **이와 같은 어플리케이션처럼 출력 결과를 수신하기 위해 연결할 뿐만아니라 입력을 제공하기 위해 연결하는 이유는 도커가 웹서버와 웹 어플리케이션같은 장기적인 실행프로세스에만 적용되는게 아니기 때문이다. 도커는 간단한 유틸리티 어플리케이션을 도커화하는데에도 사용 할 수 있다. 이와같이 입력이 필요하고, 일부 출력을 제공하는 애플리케이션을 만들 수 있다.**
