# 명명된 볼륨으로 구조하기

- 도커는 실제로 여러가지 외부 데이터 저장 메커니즘이 있는데 정확히는 두가지로 볼륨과 바인드 마운트이다. 이중 볼륨에 대해 집중해보자.

- 볼륨 예제는 우리가 원하는대로 동작하지 않았다. 실제로는 두가지 타입의 볼륨이 있으며, 둘 다 고유한 목적과 사용예가 있다. 현재는 우리는 익명의 볼륨을 사용하고 Dockerfile의 이 명령에 대해 정확하게 설명하자면, 이미지에 익명의 볼륨을 추가하고 그 이미지를 기반으로 실행되는 컨테이너에 데이터를 추가한다. 또는 명명된(named) 볼륨을 할당할수있다. 두 경우 모두 상관없이 작동하는걸 해보도록 하자. 두 경우 모두 도커는 일부 폴더와 경로를 호스트 머신에 설정한다.
  우리가 모르는 곳에 우리는 컨테이너 내부의 경로만 지정했지 호스트 머신의 경로는 지정하지않았다. 그래서 우리는 미러링된 폴더가 어디에 있는지 모른다. 물론 도커가 관리하는 어딘가에 있겠지만.. 이러한 볼륨에 액세스 할 수 있는 유일한 방법은 docker volume 명령을 사용하는것이다.

```
docker volume ls
```

를 실행해보자. 매우 이상하고 암호같은 이름을 지닌 볼륨이 나오는것을 볼수있다. 이는 익명의 볼륨이기때문에 도커가 자동으로 명명했다. 만약 feedback-app컨테이너를 중지하여 애플리케이션을 종료하는 경우 볼륨을 다시 검사하면, 익명 볼륨이 사라진다. 익명 볼륨을 관리하는건 도커인데 익명이기때문에 컨테이너가 존재하는 동안에만 실제로 존재한다. 즉, 컨테이너를 종료하면 데이터가 사라지니까. 그렇다면 이 익명 볼륨이 도움이되도록 한번 바꿔보자. 익명볼륨과 실제로 모든 바인드 마운트는 하나의 핵심 개념을 공부한다.
컨테이너에 정의된 경로는 생성된 어떤 볼륨에 매핑된다. 그래서 호스트 머신상의 생성된 경로로 연결된다.
예를 들어, 컨테이너의 이 /app/feedback 경로는 호스트 머신의 어떤 폴더에 매핑된다. 우리는 그 경로를 모르고 도커에서 관리한다. 우리의 컴퓨터 어딘가에 숨어있으며 액세스 할수없도록 되어있다.
컨테이너가 종료될때 볼륨만 삭제되지않는다면 이론적으로 쓸만한 개념인데, 명명된 볼륨이 그렇다. 명명된 볼륨을 사용하면 컨테이너가 종료된 후에도 볼륨이 유지된다. 즉, 하드 드라이브의 폴더가 그대로 유지되는것이다. 따라서 그 이후에 새 컨테이너를 시작하면 볼륨이 복구되고 폴더가 복구되어 해당 폴더에 저장된 모든 데이터를 계속 사용할수있다.
따라서 명명된 볼륨은 영구적이여야하는 데이터나, 편집하거나 직접 볼 필요가 없는 중요한 데이터에 적합하다. 실질적으로 호스트 머신의 폴더에 액세스하지 않을것이기때문이다. 익명 볼륨 명령을 명명된 볼륨으로 수정해보자. 도커파일 내부에 명명된 볼륨을 생성할수는 없다. 따라서 해당 명령어를 제거하고 대신 컨테이너를 실행할때 명명된 볼륨을 생성해야한다. 그러므로 이미지를 다시 만들도록 하자.

```
docker build -t feedback-node:volumes .
```

컨테이너를 띄워보는데 이번엔 -v라는걸 추가해보자.

```
data-volumes-01-starting-setup % docker run -d -p 3000:80 --rm --name feedback-app -v feedback:/app/feedback feedback-node:volumes
```

우리는 저장하려는 컨테이너 파일 시스템 내부의 경로를 여전히 지정해야하고 /app/feedback을 추가해줬다. 그러나 이 경로앞에 원하는 이름을 붙혀준다. 그리고 경로와 이름을 구분하기위해 콜론을 넣어준다. 이제 관리되는 볼륨에 '/app/feedback'을 저장한다 즉, 호스팅 머신에 폴더를 만들어 컨테이너 내부의 이 폴더에 연결하지만 이 볼륨은 우리가 선택한 이름으로 저장된다. 익명 볼륨과의 주요 차이점은 명명된 볼륨은 컨테이너가 종료될 때 도커에 의해 삭제되지 않는다는것이다. 익명 볼륨은 생성된다. 왜냐면 컨테이너가 생성될때마다 익명볼륨이 다시 생성되기때문에 컨테이너가 제거되면 익명볼륨은 의미가 없다. 하나의 특정 컨테이너에 밀접하게 연결되어있기때문이다. 명명된 볼륨은 하나의 컨테이너에만 연결되지는 않는다. 컨테이너를 지우고 다시 생성하는데 이때 동일한 볼륨이름을 지닌 -v 옵션으로 이전과 같은 볼륨 이름으로 재실행한후, 리로드 하면 데이터가 여전히 존재하는것을 볼 수 있다.
