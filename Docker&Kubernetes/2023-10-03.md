# Compose 파일 구성(configuration) 자세히 알아보기

- mongodb 살펴보기

  - mongo 이미지를 사용
  - 네트워크 연결
  - detached모드
  - 컨테이너 중지시 삭제
  - 데이터 베이스 데이터 유지용 명명된 볼륨
  - 환경변수에 mongodb 계정관련 값

    - 이것을 docker-compose.yaml파일로 변환하는 방법

      1. mognodb에서는 사용하려는 이미지를 가리키는 것으로 시작. image키 사용 mongo(이미지 이름일뿐 로컬이나 도커 허브 리포지토리에서 조회, 자체 저장소가 될수도있다.)
      2. 도커 컴포즈를 사용하면 rm과 detached모드가 디폴트이다. 물론 모든 서비스를 함께 시작할 때 특정 할 수도있다.
      3. 볼륨 추가

      - 볼륨 구문은 docker run시 -v 플래그와 함께 사용한것과 **정확히 동일하다**

      4. 환경변수 추가

      - 환경변수를 특정하기 위해 두가지의 대체 구문이 있다.

      ```
      - MONGO_INITDB_ROOT_USERNAME=max 혹은
      MONGO_INITDB_ROOT_USERNAME: max
      ```

      - 다른 옵션으로는 환경변수 파일 지정도 가능하다.
        - docker run에서는 --env-file 옵션을 이용 컴포즈에서는 예를들어 프로젝트 폴더 아래에 env/mongo.env가 있다면 env_file을 이요해 docker-compose.yaml파일에서 사용하려는 환경변수 파일에 대한 **상대 경로를 입력**
        ```
        env_file:
            - ./env/mongo.env
        ```

      5. 네트워크 추가

      - networks 키를 추가하여 네트워크를 추가 할 수 있으며 컨테이너가 속해야하는 모든 네트워크를 특정할수있다. 하지만 많은 경우 이 작업을 하지않아도 된다. **도커 컴포즈를 사용하면 도커가 이 컴포즈파일에 특정된 모든 서비스에 대해 새환경을 자동으로 생성하고 모든 서비스를 즉시 그 네트워크에 추가함.**
        물론 네트워크를 특정하는것도 가능하다!!

      6. 볼륨키 추가

      - services아래에 들여쓰기 한 수준이 아닌 services와 동등한 들여쓰기 수준이 되어야한다. 최상위 수준의 volumes키
      - services에서 사용 중인 명명된 볼륨이 나열되어야한다. 단순히 콜론과 함께 추가되는데 값은 없다. 이상하게 보일수있으나 도커가 services를 위해 생성해야 하는 명명된 볼륨을 인식하기 위해 필요한 구문!
      - 참고사항으로 다른 서비스에서 동일한 볼륨이름을 사용하면 그 볼륨이 공유된다. 따라서 다른 컨테이너가 호스트 머신상의 동일한 볼륨 동일한 폴더를 사용할 수도 있다. 따라서 명명된 볼륨을 지금처럼 지정해야함 **하지만 익명 볼륨과 바인드마운트는 지정 할 필요없다.**
