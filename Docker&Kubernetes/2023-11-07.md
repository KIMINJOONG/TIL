# 다중컨테이너 앱 준비하기

- 배포시에 도커 컴포즈는 사용하지않는다.

  - 도커 컴포즈는 docker-compose 파일에서 컨테이너를 찾아 구성을 실행하는데 유용한 도구이며, 로컬 머신의 다중 컨테이너에도 가능하다. 하지만 당장은 배포에 훌륭한 도구는 아니다.

- 우선 다운받은 프로젝트의 백엔드 이미지를 빌드한다.
  - 이미지를 만들기전 ecs의 경우에는 로컬에서 매우 잘 작동하는 컨테이너 이름으로 컨테이너 IP를 자동으로 찾기 기능을 사용할수없다.
  - 왜? 생각외로 간단하다. 로컬머신에서 도커를 로컬로 실행하면 한 컴퓨터에서 발생, 도커는 그곳에서 또 다른 컨테이너 실행 그리고 도커 네트워크 명령 또는 도커 컴포즈를 사용하여 도커 네트워크를 생성하면, 로컬 머신의 동일한 네트워크에 넣을수잇었다. 그러나 ecs에 뭔가를 배포한다면 컨테이너와 컨테이너의 각각 인스턴스는 클라우드 프로바이더에 의해 실행되고 관리된다.
  - 그리고 항상 동일 머신에서 실행되는것이 아님 거의 가능성 없다. 그렇기때문에 도커 네트워크 접근 방식이 더 이상 작동하지 않는다.
  - ECS의 경우에는 동일한 태스크에 컨테이너를 추가하면, 동일한 머신에서의 실행이 보장된다. 이것이 우리가 할일!
  - 그래도 여전히 AWS ECS는 도커 네트워크를 생성하지않고 그 대신 localhost를 컨테이너 애플리케이션 코드 내부의 주소로 사용할수있게해준다, 그렇기때문에 localhost를 대신 사용하자.
  - 그래서 우리는 해당 부분을 개발일때는 컨테이너명, 배포일때는 localhost로 사용할수있게 환경변수화 시켜주자.

```
${process.env.MONGODB_URL}
```

- 백엔드를 도커로 빌드한다 이미지 명은 goals-node
- 도커 허브에 새 리포지터리 만들기(goals-node)
- docker tag goals-node ijboym216/goals-node로 태그 다시 지정
- docker push ijboym216/goals-node 로 푸시
