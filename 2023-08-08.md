# Bastion Host란?

- 외부에서 Private subnet에 있는 WEB, WAS, DB 서버에 직접 접속하면 보안상으로 위험해질수 있다. 그러므로 Bastion Host는 일종의 Proxy서버 역할을 하며 정해둔 ip를 제외하고는 Bastion Host를 거쳐 private server에 접속하지못하도록 해서 보안을 강화 할 수 있다.

# IP(Internet Protocol)?

- IP주소를 알기전에 간단하게 IP란 뭘까? 이는 **Internet Protocol** 의 약자로 **패킷 교환 네트워크(인터넷)에서 데이터를 주고받을 때의 통신 규약이다.** OSI계층에서 IP계층은 호스트의 주소지정과 패킷분할 및 조립 기능을 담당

# IP Address(Internet Protocol Address)

- 컴퓨터들이 다른 컴퓨터로 데이터를 전송하고 주고받기 위해서 각 컴퓨터들의 주소가 존재해야함. 그래야 어떤 데이터를 전송할 때 그 데이터의 최종 목적지를 알 수 있기 때문이다. 그래서 **네트워크(인터넷)상에서 데이터를 주고받기 위해 모든 컴퓨터들은 각자의 주소를 가지는데 그 주소가 IP 주소(IP Adress)**이다.
  - 일반적으로 IP 주소를 IP라고 부르는 경우가 있는데, IP라는 것은 통신 프로토콜 자체를 의미하는것이고, IP주소는 인터넷 상에서 데이터를 주고 받을때 사용되는 주소 이므로 혼동하지 말아야한다.
  - IP = 프로토콜<br/> IP 주소 = 주소

# IPv4 & IPv6

- IP주소를 부여하는 방식은 어떤것이 있을까? 대표적으로 가장 대중적으로 사용하는 IPv4와 최근에 고안된 IPv6가 있다.

# IPv4

- 현재 우리가 **일반적으로 사용하는주소**는 IPv4라고 보면 된다. **32비트로 이루어져 있으며, 8비트씩 4개의 구간으로 나누어서 나타낸다.** 각 자릿수는 0~255(2^8)의 범위로 표현이 가능하다.

# 옥텟(Octet)

- 사전적 의미로는 컴퓨터에서 8개의 비트가 한데 모인것을 말함. 초기 컴퓨터에서는 1바이트가 꼭 8비트만을 표현하지는 않았기 때문에 옥텟이라는 용어를 생성하게 됌
- IPv4 주소에서의 옥텟은 **32비트의 IP주소를 8비트로 나누는 단위**라고 할 수 있다. IP 주소는 32비트로 이루어져 있고 그것을 옥텟단위로 끊어서 표현. 각 옥텟은 10진수로 0~255의 값을 가지게 된다.
  요약 하자면 **IPv4 주소는 총 32비트로 이루어져있는데 4구간으로 나누어서 사용**된다. 그래서 8비트씩 4구간으로 나누어서 사용하게 되는데 8비트씩 나누어진것을 옥텟이라고 한다.

![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99E647425B502BAA10)

# IPv6(IP Version 6)

- 위에서 보여준 IPv4가 현재 가장 많이 사용되고 있으나 이 주소 체계로는 약 42억개의 주소만을 표현할수 있다. 그러나 전 세계 인구수는 74억명에 이른다고 한다. 그렇다면 컴퓨터가 굉장히 보편화되어 한명당 하나의 컴퓨터에 IP만 부여해도 그 수는 부족하게 되어 **IPv4방식의 IP주소는 고갈되었다.**

물론 이런 부족한 IP주소를 더 많은 컴퓨터에서 사용 할 수 있도록 하는 기술은 다양하게 존재한다(유동 IP, 서브넷 마스크 등) 하지만 결국 한계가 있기에 IPv6가 탄생하게 되었다.

IPv4에서 32비트를 사용했다면, IPv6에서는 128 비트로 확장하였다. 32비트 주소체계로 표현할수있는 IP주소의 수가 약 42억개였다면 IPv6는 2의 128제곱개의 IP주소를 표현 할 수 있고 이를 계산하면 읽기도 힘든 엄청난 수가 나온다. **IPv4를 옥텟단위로 4등분하여 표기하였다면 IPv6는 2옥텟(16비트)단위로 8등분하여 표기한다.** 따라서 각 자리는 네자리의 16진수로 표현되고, 각 자릿수들은 콜론(:)으로 구분하여 표기한다.<br/>
ex) 2001:0db8:85a3:08d3:1319:8a2e:0370:7334

# 다 IPv6로 바꾼다면?

- 현재 사용중인 장비들은 IPv4방식을 처리하기위해 만들어진 것이 많다. 따라서 IPv6를 사용한다고 해도 그것을 IPv4형식으로 변환하여 사용한다. **또한 IPv6는 아직 인프라가 많이 약한 상태여서 보안대책이 많이 약하기 때문에 섣불리 전환 할 수 없다.** 만약에 DDos공격이 IPv6체계로 이루어 진다면, 그 IP 주소를 추적하는것도 상당히 어려울 것이다.

# 네트워크 클래스 등장 배경

- 먼저 IPv4는 32비트로 이루어져 있다. 따라서 2^32, 약 40억개의 주소를 가진다. 처음에 IP주소를 설계할때는 40억개 정도면 전 인류가 사용할줄 알았으나 **턱 없이 부족**한 수였다.
- 우리가 개인적으로 가지고 있는 기기 종류만 해도 노트북, 스마트폰, PC등이 있다.물론 현재 IPv4환경에서 우리는 기기하나당 IP주소를 하나씩 부여하지는 않지만, 애초에 충분한 IP주소가 있었다면 기기마다 부여해서 네트워크 환경 구축을 쉽게 할 수 있었을 것이다. 최근에는 스마트폰에 내부적으로 새로운 IPv6체계의 IP주소를 부여하고 있고(핫스팟 기능을 사용 할 수 있다는것은 공인 IP가 존재한다는것) 전반적으로 IPv6환경으로 천천히 넘어가고있는 추세.
- 하지만 인프라가 IPv4환경으로 구축되어있다. **따라서 이미 구성된 인프라를 최대한 활용하기 위해서 IPv4체계의 IP주소를 사용하는 네트워크의 규모에 따라 관리하기 쉽도록 클래스라는 이름으로 나누기 시작했고, 이는 네트워크 클래스의 등장**으로 이어진다.

# 네트워크 클래스(Network Class)

- 우리가 일상적으로 사용하는 범위의 IP주소는 아래와 같은 구조를 가지고 있다. 일반적으로 사용되는 A,B,C Class 네트워크에 포함된다.<br/>
  **IP주소 = 네트워크 주소 + 호스트 주소**<br/>
  여기서 **네트워크 주소**는 **인터넷 상에서 네트워크를 구분하는 역할**이고, **호스트 주소**는 **특정 네트워크 안에 존재하는 기기들을 구분하는 역할**을 한다.

  ![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99DC55505B88C76B28)

- 이래를 위해서 위의 그림을 참고해보면, 어떤 라우터에 연결된 네트워크 인지 구분하는 것은 그 IP주소가 어떤 클래스냐에 따라서 그 비트수가 결정 된다.

- 위의 예시에서는 첫번째 옥텟의 수가 0~127사이에 있는 A Class 네트워크이기 때문에, 앞쪽의 8비트를 통해 네트워크를 구분해 어떤 네트워크 인지 찾아간다. 따라서 라우터는 네트워크 주소만을 판별한다고 할 수 있다. 호스트 주소는 라우터에게 별로 중요치 않은 정보이다.

- 네트워크 주소를 통해 해당 네트워크를 찾아가게 되면, 그 네트워크 내에 여러개의 장치들이 연결되어 있을 것이다. 바로 네트워크 내에서 장치들을 구분하기 위해 존재하는 주소가 호스트 주소이다.

- 따라서 위의 원리를 이해한다면, **네트워크 주소를 통해 네트워크를 찾아가고, 호스트 주소를 통해 네트워크 내의 특정 장치로 접근한다**는 것을 쉽게 이해할 수 있을것이다.

- IPv4네트워크 클래스라는것은 네트워크를 규모에 맞게 잘 사용하기 위해서 네트워크 주소의 비트 수, 호스트 주소의 비트 수를 약속에 의해서 나눠놓은것으로 볼 수 있다.

# D Class, E Class

- 이 두 클래스는 A, B, C Class IP주소와는 다른 용도로 쓰인다. 일반 IP주소처럼 동일하게 사용할 수 없다. 따라서 네트워크 주소, 호스트 주소로 나눠져 있지않은 특수용도 IP주소 이다.

- D Class 네트워크는 멀티캐스트를 위해서 존재하는 네트워크. 여기서 **멀티캐스트**라는 것은 한번의 메시지 송신으로 특정 네트워크 안에 있는 두 개 이상의 컴퓨터에게 전송할 수 있도록 하는 기술이다.

- **E Class**네트워크는 예약된 주소로 **미래에 사용될 용도로 구분해 놓은 네트워크**라고 한다.

# 예약된 IP 주소

- 특정 IP주소는 특정한 기능을 수행하도록 약속되어 있다.

1. 127.0.0.1 - 루프백(Loopback)주소, 자기 자신을 가리키는 주소이다.
2. 192.168.0.0 - 사설 네트워크
3. 224.0.0.0 - 멀티캐스트
4. 240.0.0.0 - 미래 사용 용도로 예약

# 네트워크 클래스를 현재도 사융 중일까?

- 현재는 위의 클래스로 나눠 사용하지 않는다. 위의 클래스로 구분하게 되면 어떤 기업이 웹 서비스를 구현하는데 있어서 Class C 네트워크 보다는 더 많은 호스트 수가 필요하고, Class B 네트워크 보다는 더 적은 호스트 수가 필요한 상황에서 Class B 주소를 할당받는다면, 이는 IP주소의 낭비로 이어진다.

따라서 이를 보완하기 위해 등장한 **서브넷(Subnet)**이라는 기술을 사용하면, 네트워크 영역을 클래스로 구분한것 처럼 8비트, 16비트, 24비트로 구분하지않고, **네트워크 주소를 17비트, 27비트로 적절한 양으로 구분**할 수 있게된다. 즉 **개념적으로 사용하고는 있지만, 서브넷과 연계하여 사용하는것이 일반적**이다.

# 서브넷 탄생 배경

- 클래스 단위로 네트워크를 분류하다보니, 어떤 기업에서는 적은 양의 호스트 주소가 필요한데, B Class 네트워크를 할당받아서 IP주소에 여유가 생기게 되고, 어떤 기업에서는 많은 양의 호스트 주소가 필요한데, C Class 네트워크를 할당받아서 IP주소가 부족해지는 현상이 생기게 된다.<br/>
  따라서 클래스로만 네트워크를 분류하는 것은 비효율적이라는 결론이 나오고, 좀 더 **적절한 단위로 네트워크를 분할해야할 필요성**이 생기게 된다. 이러한 이유로 서브넷의 개념이 탄생했다.

# 서브넷(Subnet)

- 클래스 단위로 분류를 하게 되면 적절한 네트워크의 크기로 구분 할 수 없다. 따라서 서브넷으로 분할하여 사용한다. **서브넷(Subnet)**이라는것은 하나의 네트워크가 분할되어 나눠진 작은 네트워크이다. **네트워크를 분할하는것을 서브네팅(Subnettin)**이라고 한다. 그리고 이 서브네팅은 **서브넷 마스크(Subnet Mask)를 통하여 수행**될 수 있다.

```
11001101 00000000 00000001 xxxxxxxx
```

- 이 IP주소는 최상위 비트가 11이므로 C Class 네트워크라고 할 수 있다. 따라서 앞의 24비트는 네트워크의 주소이고 뒤의 8비트는 호스트 주소이다. 기본적으로 C Class 네트워크는 기본 서브넷 마스크로 /24를 가지고 있다. 즉 **서브넷 마스크 값은 네트워크 주소를 나타내는 비트 수를 명시한 값**이다. 이를 2진수로 표현하자면 11111111 11111111 11111111 00000000 으로 표현 될수 있을것이다.<br/>
  여기서 이 네트워크가 가질 수 있는 호스트 주소의 수는 256개 이다. 하지만 이 네트워크 호스트를 128개씩 가지는 두개의 네트워크로 분할하고 싶을 때 서브넷으로 분할한다.

```
11001101 00000000 00000001 1xxxxxxx
11001101 00000000 00000001 0xxxxxxx
```

- 위와 같이 네트워크를 분할하고 싶다면, 네트워크 주소를 나타내는 부분이 25자리로 기존의 C Class 네트워크보다 네트워크 주소를 나타내는 부분이 한 자리 더 많다. 이렇게 되면 서브넷 마스크는 /25 라고 표현 할 수 있을것이다.<br/>
  만약 서브넷 마스크를 변경하여 네 개의 서브넷으로 분할하고 싶다면, 한자리 더 네트워크 주소로 넘기면 된다. 하지만 이렇게 **분할을 많이 하게 되면, 하나의 서브넷에 가질 수 있는 호스트 주소가 줄어들게 되므로, 로컬 네트워크의 규모에 따라서 서브넷 마스크 값을 잘 조정하는것이 필요**

## 그렇다면 서브넷 마스크를 어떻게 활용해서 서브넷을 구별하는 것일까? 예를 들어서 하나의 IP가 있다고 생각

```
205.0.1.129
```

- 하나의 IP주소이다. 하지만 서브넷 마스크 값은 다음과 같다. 서브넷 마스크가 IP주소의 형태가 비슷하게 생겼다고 해서 IP주소랑 혼동해서는 안된다. **서브넷한 마스크 값은 단지 현재 내가 속한 네트워크가 어디까지 네트워크 주소를 표현하는지 명시하는 값**일 뿐이다.

```
255.255.255.128
```

- 이런 마스크값을 가지고 있다면, 앞에서 25개의 비트는 네트워크 주소라는 것을 알 수 있다.<br/>
  205.0.1.129 ~ 205.0.1.255 라는 네트워크에 속한 호스트의 IP주소라는 것을 알 수 있다. 이는 아래와 같이 간소화하여 표현할 수 있다.

```
205.0.1.129/25
```

- 뒤의 /25는 최상위 비트부터 25비트까지가 네트워크 주소로 인식된다는 것을 의미한다. 따라서 우리가 어떠한 네트워크에 들어가도 서브넷 마스크라는 값을 반드시 가지고 있게 된다.

# 서브넷이 필요한 이유

- 이러한 기술들은 결국 각 클래스로 나눠진 **네트워크를 운영중인 서비스의 규모에 맞게 분할**하여 사용하기 위한 기술이다. 따라서 이런 기술을 통해서 A Class 네트워크와 같은 매우 큰 네트워크를 작게 나눠서 사용하면서, **낭비되는 IP주소 자원을 최소화하려는 것이 주된 목적**이다.

- 다른 이유로는 브로드 캐스팅을 사용할 때이다. 이 기술은 특정 네트워크에 연결된 모든 기기에 하나의 메시지로 동시에 데이터를 보내는것이다. 이를 사용 할 때 연결된 호스트 디바이스가 많다면, 당연히 성능의 저하가 올 수 있다. 따라서 **네트워크의 규모를 줄여서 브로드 캐스팅으로 인한 부하를 줄 일수 있는것**이다.
